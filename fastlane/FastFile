fastlane_version '2.53.1'

platform :ios do
    # iOS Lanes
    lane :genIpa do
        build_app(scheme: "YatuDashboard", workspace: "./ios/YatuDashboard.xcworkspace", include_bitcode: true)
    end
end
  
platform :android do 
    desc "Build Android Developer APK"
    lane :genDevApk do 
        gradle(
            task: "clean assembleRelease",
            flavor: "YatuDeveloper",
            project_dir: './android'
        )
    end

    desc "Release for the Android production"
    lane :pushToPlayStore do
        # increment_version_number_in_plist(bump_type: 'patch')
        android_set_version_code(
            gradle_file: "./android/app/build.gradle"
        )

        versionCode = android_get_version_code(
            gradle_file: "./android/app/build.gradle"
        )

        android_set_version_name(
            version_name: versionCode,
            gradle_file: "./android/app/build.gradle"
        )

        gradle(
            task: "clean",
            project_dir: './android'
        )
        gradle(
            task: 'bundle', 
            flavor: "Yatu",
            build_type: "release",
            project_dir: './android', 
            properties: {
                "android.injected.signing.store.file" => ENV['PWD'] + "/android/app/yatu.jks",
                "android.injected.signing.store.password" => "vt8888",
                "android.injected.signing.key.alias" => "yatu",
                "android.injected.signing.key.password" => "vt8888"
            }
        )
        supply(track: 'production', aab: './android/app/build/outputs/bundle/YatuRelease/app-yatu-release.aab')
    end
end
  